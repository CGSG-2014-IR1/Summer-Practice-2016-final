<html>
<head>
  <title>Spectator</title>

  <link rel="stylesheet" type="text/css" href="styles.css">

  <script src="js/api/socket.io.js"></script>
  <script src="js/api/jquery.js"></script>
  <script src="js/api/require.js"></script>
  <script src="js/api/three.js"></script>
  <script>
    function InitChat( socket )
    {
      $('#chat_form').submit(function()
      {
        var inp = $('#msg');
        socket.emit('chat message', {message: inp.val(), user: $("#name").val()});
        inp.val('');
        return false;
      });
      socket.on('chat message', function(msg)
      {
        var msgs = $('#messages');
        msgs.append("<li>" + "[" + msg.user + "]: " + msg.message);
        if ($('#messages li').length > 30)
          $('#messages li').eq(0).remove();
      });
    }

    $(function()
    {
      var socket = io.connect();
      InitChat(socket);
      require(['js/config'], function()
      {
        require(
          [
            'animation/anim',
            'units/layouts/battlefield_spectator'
          ], function(anim, field)
          {
            var Anim = new anim();
            Anim.Init("field");
            Anim.UnitAdd(new field(socket, 10, "figure_info"));

            Anim.Run("field");
          });
      });

    })
  </script>
</head>


<body>
<table width="100%" height="100%">
  <tr>
    <td width="80%" id="field"></td>
    <td width="20%">
      <table>
        <tr>
          <td class="figure_info" id="figure_info">
          </td>
        </tr>
        <tr>
          <td>
            <ul id="messages"></ul>
            <form id="chat_form">
              <input type="text" id="msg" autocomplete="off"/><button>Say</button>
              <br>
              <input type="text" id="name" autocomplete="on">Your name</input>
            </form>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
</body>

</html>